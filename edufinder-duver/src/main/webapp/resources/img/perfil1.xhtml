<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mi Perfil - EduFinder</title>
    <link rel="stylesheet" href="../css/diseñoPerfilUsuario.css" />
</head>
<body>
    <!-- Barra lateral -->
    <div class="sidebar">
        <div class="profile">
            <h3 id="sidebar-username">Usuario</h3>
        </div>
        <a href="../html/perfil.xhtml">Mi Perfil</a>
        <a href="../html/principal inicio.xhtml">Paguina Principal</a>
        <a href="../html/test.xhtml">Test</a>
        <a href="../html/universidades.xhtml">Universidades</a>
        <a href="../html/profesionales.xhtml">Profesionales</a>
        <a href="../html/servicio.xhtml">Servicios</a>
        <a href="../html/plan de estudio.xhtml">Plan de Estudio</a>
        <a href="../../index.html" onclick="localStorage.removeItem('usuarioActual');">Cerrar Sesión</a>
    </div>

    <!-- Contenido principal -->
    <div class="content">
        <div class="header">
            <h1>Mi Perfil</h1>
        </div>

        <div class="profile-container">
            <div class="profile-section">
                <h2>Información Personal</h2>
                <div class="profile-info">
                    <div class="info-item">
                        <label for="edit-nombre">Nombre(s)</label>
                        <input type="text" id="edit-nombre" />
                    </div>
                    <div class="info-item">
                        <label for="edit-primer-apellido">Primer Apellido</label>
                        <input type="text" id="edit-primer-apellido" />
                    </div>
                    <div class="info-item">
                        <label for="edit-segundo-apellido">Segundo Apellido</label>
                        <input type="text" id="edit-segundo-apellido" />
                    </div>
                    <div class="info-item">
                        <label for="edit-tipo-documento">Tipo de Documento</label>
                        <select id="edit-tipo-documento">
                            <option value="C.C">C.C</option>
                            <option value="T.I">T.I</option>
                            <option value="Pasaporte">Pasaporte</option>
                            <option value="Carnet Extranjería">Carnet de Extranjería</option>
                        </select>
                    </div>
                    <div class="info-item">
                        <label for="edit-edad">Edad</label>
                        <input type="number" id="edit-edad" min="1" max="120" />
                    </div>
                </div>
            </div>

            <div class="profile-section">
                <h2>Información de Cuenta</h2>
                <div class="profile-info">
                    <div class="info-item">
                        <label for="edit-email">Correo Electrónico</label>
                        <input type="email" id="edit-email" />
                    </div>
                    <div class="info-item">
                        <label for="edit-username">Nombre de Usuario</label>
                        <input type="text" id="edit-username" />
                    </div>
                    <div class="info-item">
                        <label for="edit-password">Contraseña</label>
                        <input type="password" id="edit-password" />
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="btn" onclick="guardarCambios()">Guardar Cambios</button>
                <a href="../../index.html" class="btn" onclick="localStorage.removeItem('usuarioActual');">Cerrar Sesión</a>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Cargar datos del usuario al abrir la página
        document.addEventListener('DOMContentLoaded', function() {
            var usuarioActual = JSON.parse(localStorage.getItem('usuarioActual'));

            if (!usuarioActual) {
                alert('No hay usuario logueado. Será redirigido al inicio de sesión.');
                window.location.href = 'registro.xhtml';
                return;
            }

            // Mostrar nombre de usuario en la barra lateral
            document.getElementById('sidebar-username').textContent = usuarioActual.username || 'Usuario';

            // Rellenar formulario con datos del usuario
            document.getElementById('edit-nombre').value = usuarioActual.nombre || '';
            document.getElementById('edit-primer-apellido').value = usuarioActual.primerApellido || '';
            document.getElementById('edit-segundo-apellido').value = usuarioActual.segundoApellido || '';
            document.getElementById('edit-tipo-documento').value = usuarioActual.tipoDocumento || 'C.C';
            document.getElementById('edit-edad').value = usuarioActual.edad || '';
            document.getElementById('edit-email').value = usuarioActual.email || '';
            document.getElementById('edit-username').value = usuarioActual.username || '';
            document.getElementById('edit-password').value = usuarioActual.password || '';
        });

        function guardarCambios() {
            var usuarioActual = JSON.parse(localStorage.getItem('usuarioActual'));
            var usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];

            var usuarioActualizado = {
                nombre: document.getElementById('edit-nombre').value,
                primerApellido: document.getElementById('edit-primer-apellido').value,
                segundoApellido: document.getElementById('edit-segundo-apellido').value,
                tipoDocumento: document.getElementById('edit-tipo-documento').value,
                edad: document.getElementById('edit-edad').value,
                email: document.getElementById('edit-email').value,
                username: document.getElementById('edit-username').value,
                password: document.getElementById('edit-password').value
            };

            if (!usuarioActualizado.nombre || !usuarioActualizado.primerApellido ||
                !usuarioActualizado.tipoDocumento || !usuarioActualizado.edad ||
                !usuarioActualizado.email || !usuarioActualizado.username ||
                !usuarioActualizado.password) {
                alert('Por favor complete todos los campos obligatorios.');
                return;
            }

            var usuarioIndex = usuarios.findIndex(function(u) {
                return u.email === usuarioActual.email || u.username === usuarioActual.username;
            });

            if (usuarioIndex !== -1) {
                usuarios[usuarioIndex] = usuarioActualizado;
                localStorage.setItem('usuarios', JSON.stringify(usuarios));
                localStorage.setItem('usuarioActual', JSON.stringify(usuarioActualizado));

                document.getElementById('sidebar-username').textContent = usuarioActualizado.username;
                alert('Cambios guardados exitosamente.');
            } else {
                alert('Error al actualizar el perfil.');
            }
        }
    </script>
</body>
</html>
